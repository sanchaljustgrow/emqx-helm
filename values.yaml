# ───────────────────────────────────────────────
# Replica Count (StatefulSet)
# ───────────────────────────────────────────────
replicaCount: 3

# ───────────────────────────────────────────────
# EMQX Service
# ───────────────────────────────────────────────
service:
  type: ClusterIP
  ports:
    - name: mqtt
      port: 1883
      targetPort: 1883
    - name: dashboard
      port: 18083
      targetPort: 18083
    - name: metrics
      port: 18084
      targetPort: 18084

# ───────────────────────────────────────────────
# Clustering
# ───────────────────────────────────────────────
clustering:
  strategy: "k8s"
  discovery: "k8s"
  k8s:
    namespace: emqx
    serviceName: emqx-headless

# ───────────────────────────────────────────────
# Resource Limits
# ───────────────────────────────────────────────
resources:
  limits:
    cpu: 500m
    memory: 512Mi
  requests:
    cpu: 250m
    memory: 256Mi

# ───────────────────────────────────────────────
# Metrics + Prometheus Monitoring
# ───────────────────────────────────────────────
metrics:
  enabled: true
  port: 18084

serviceMonitor:
  enabled: true
  interval: 15s
  scrapeTimeout: 10s

# ───────────────────────────────────────────────
# Dashboard Listener
# ───────────────────────────────────────────────
listener:
  http:
    dashboard:
      port: 18083

# ───────────────────────────────────────────────
# Disable anti-affinity for local cluster
# ───────────────────────────────────────────────
affinity: {}

# ───────────────────────────────────────────────
# Persistent Volume
# ───────────────────────────────────────────────
persistence:
  enabled: true
  storageClass: standard
  accessModes:
    - ReadWriteOnce
  size: 1Gi

# ───────────────────────────────────────────────
# Health Probes
# ───────────────────────────────────────────────
livenessProbe:
  httpGet:
    path: /status
    port: 18083
  initialDelaySeconds: 30
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6

readinessProbe:
  httpGet:
    path: /status
    port: 18083
  initialDelaySeconds: 10
  periodSeconds: 10
  timeoutSeconds: 5
  failureThreshold: 6

# ───────────────────────────────────────────────
# Environment Variables
# ───────────────────────────────────────────────
env:
  EMQX_NAME: emqx
  EMQX_HOST: 0.0.0.0
  EMQX_NODE_COOKIE: mysecretcookie
